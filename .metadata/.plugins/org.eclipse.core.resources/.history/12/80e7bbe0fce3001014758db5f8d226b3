#ifndef BSP_BME280_H_
#define BSP_BME280_H_

// I2C handle I2C1
extern I2C_HandleTypeDef hi2c1;

/* Some definition for work with BME280 */

/* Application configurable items */
#define BME280_I2C						I2C
#define BME280_GPIO_PORT				GPIOB
#define	BME280_I2C_ADDR					(0x76 << 1)
#define BME280_TIMEOUT					1000

#define BME280_CALIB1_ADDR				0x88
#define BME280_CALIB1_SIZE				25
#define BME280_CALIB2_ADDR				0xE1
#define BME280_CALIB2_SIZE				7

#define BME280_ID						0x60
#define BME280_ID_ADDR					0xD0

/* Some configuration macros */

#define BME280_CTRL_HUM_ADDR			0xF2
#define BME280_OSRS_H					0x01

#define BME280_CTRL_MEAS_ADDR			0xF4
#define BME280_OSRS_T					(0x01 << 5)
#define BME280_OSRS_P					(0x01 << 2)
#define BME280_MODE						0x3

#define BME280_CONFIG_ADDR				0xF5
#define BME280_T_SB						(0x5 << 5)
#define BME280_FILTER					(0x2 << 2)
#define BME280_SPI3W_EN					0x0

/* Data register address macros */

#define BME280_PRESSURE_ADDR			0xF7
#define BME280_TEMPERATURE_ADDR			0xFA
#define BME280_HUMIDITY_ADDR			0xFD

typedef int32_t BME280_S32_t;
typedef uint32_t BME280_U32_t;
typedef int64_t BME280_S64_t;

/* Some structures for calibrating and for data ( temperature / pressure / humidity */
typedef struct
{
	uint16_t dig_T1;
	int16_t dig_T2;
	int16_t dig_T3;

	uint16_t dig_P1;
	int16_t dig_P2;
	int16_t dig_P3;
	int16_t dig_P4;
	int16_t dig_P5;
	int16_t dig_P6;
	int16_t dig_P7;
	int16_t dig_P8;
	int16_t dig_P9;

	uint8_t dig_H1;
	int16_t dig_H2;
	uint8_t dig_H3;
	int16_t dig_H4;
	int16_t dig_H5;
	int8_t dig_H6;

	int32_t t_fine;

}BME280_calib_t;

typedef struct
{
	double temperature;
	double pressure;
	double humidity;

}BME280_data_t;

/* Function prototypes */
HAL_StatusTypeDef bme280_init(void);

/* Read Data function */
HAL_StatusTypeDef bme280_get_data(BME280_data_t* data);

#endif /* BSP_BME280_H_ */
